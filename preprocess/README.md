## （多账户）企业收支流水清洗方法：
#### 1、对流水数据打标签：根据附件1-流水标签一期版本202112中的逻辑对流水数据打标签；[部分标签代码逻辑可才参考附件2：label.py]
#### 2、多账户流水合并：以三个账户ABC为例，构建虚拟的合并账户V
     ①确认AB各自的逐笔交易前，交易后的流水是自洽的；
     ②将AB两个账户的交易明细，按交易时间，直接融合起来。并生成虚拟账户的余额列。
      PS：按自然建议顺序，逐条演绎交易过程，将两个账户发生的交易视同一账户，更新填充前面提到的虚拟账户余额列。并且，注意将AB内部发生的所有双向可抵消交易对进行冲销，从交易记录中删除。
     ③用以上同样的方式，将AB合并后账户与C进行合并，得到V。
#### 3、新增每个客户近3年账户每日余额表：包含客户统一编号，账户名称，对公存款账户，时间，账户余额，上报金融机构编码字段，余额清洗规则如下：
    ①以账户为维度，对每个账户的余额进行清洗；
     ②日末余额：取每个账户当天最后一笔交易对应的余额为当天的日末余额；
    select * from(
    select row_number() over(partition by khtybh,report_org,dgckzh,hxjyrq order by concat(hxjyrq,hxjysj) desc)rn,t.* from dwd_dgckfhzmx t) where rn =1
    ③如当天没有发生交易，当天日末余额用上一天的日末余额填充；
#### 4、交易对手名称统一化：将交易对手类似的账户名清洗为统一的账户名，代码逻辑参考附件3：identifySameBuyers.py（部分代码，后续补充完整代码）； 
#### 5、交易对手是否为白名单企业的匹配结果。运用一组事先准备的白名单清单（已脱敏），与客户的交易对手名称进行文本匹配，逐个标记是否为白名单企业。